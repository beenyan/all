<!doctype html>
<html>
  <meta charset="utf-8">
  <head>
    <script src="js/jquery-3.4.1.js"></script>
    <link rel="stylesheet" href="js/jquery-ui.css">
    <script src="js/jquery-ui.js"></script>
    <link rel="stylesheet" src="js/jquery-ui.min.css">
    <script src="js/jquery-ui.min.js"></script>
    <title>無標題文件</title>
  </head>
  <style>
    body{
      text-align: center;
    }
    .wc{
      border: 1px inset rgb(128, 128, 128);
    }
  </style>
  <body>
    <div id="dialog0">
      <h1 class="time">60</h1>
      <h1>是否繼續留在本頁上?</h1>
      <input type="button" id="YES" value="YES">
      <input type="button" id="NO" value="NO">
    </div>
    <div id="dialog1">
      <table align="center" border="1">
        <tbody id="tb">
          <tr>
            <td>名稱</td>
            <td>時間</td>
            <td>動作</td>
            <td>結果</td>
          </tr>
        </tbody>
      </table>
    </div>
    <h1>管理員專區</h1>
    <h1 class="time">60</h1>
    <input type="button" value="log" id="log"><input type="button" value="logout" id="logout"><br>
    <input type="text" id="settime" value="60"><input type="button" onclick="timeset()" value="設置時間"><input type="button" onclick="reetime()" value="重設時間"><br>
    <input type="text" id="search"><input type="button" id="searchb" value="查詢">
    <table align="center" border="1">
      <tbody id="tbody">
        <tr>
          <td><input type="button" value="ID" id="b10" class="sort"></td>
          <td><input type="button" value="帳號" id="b20" class="sort"></td>
          <td><input type="button" value="名稱" id="b30" class="sort"></td>
          <td><input type="button" value="密碼" id="b40" class="sort"></td>
          <td><input type="button" value="權限" id="b50" class="sort"></td>
          <td>修改</td>
          <td>刪除</td>
        </tr>
      </tbody>
    </table>
  </body>
  <script>
    $(function(){
      $.post({
        async:false,
        url : "allcall.php?call=1",
        success:function(e){
          creatnew();
          let list = e.split("$(*/)");
          let arr = [];
          list.pop();
          for (let i = 0 ; i < list.length; i++){
            arr = JSON.parse(list[i]);
            $("#tbody").append(`
              <tr class="tr">
                <td><input type="text" id="t0${arr[0]}" value="${arr[0]}"></td>
                <td><input type="text" id="t1${arr[0]}" value="${arr[1]}"></td>
                <td><input type="text" id="t2${arr[0]}" value="${arr[2]}"></td>
                <td><input type="text" id="t3${arr[0]}" value="${arr[3]}"></td>
                <td>
                  <select id="s${arr[0]}">
                    <option value="1">一般使用者</option>
                    <option value="2">一般管理者</option>
                    <option value="3">超級管理者</option>
                  <select>
                </td>
                <td><input type="button" value="修改" id="fix${arr[0]}" class="fix"></td>
                <td><input type="button" value="刪除" id="dele${arr[0]}" class="dele"></td>
              </tr>
            `);
            $("#s"+arr[0]).val(arr[4]);
          };
        },
      });
      function creatnew(){
        $("#tbody").append(`
          <tr class="tr">
            <td><input type="text" readonly="readonly" id="t0"></td>
            <td><input type="text" class="wc" id="t1"></td>
            <td><input type="text" class="wc" id="t2"></td>
            <td><input type="text" class="wc" id="t3"></td>
            <td>
              <select id="s">
                <option value="1">一般使用者</option>
                <option value="2">一般管理者</option>
                <option value="3">超級管理者</option>
              <select>
            </td>
            <td colspan="2"><input type="button" value="新增" id="cn"></td>
          </tr>
        `);
      };
      $("#cn").mousedown(function(){
        let none = 0;
        $(".wc").each(function(){
          if ($(this).val()==""){
            $(this).css("border","2px inset rgb(255, 0, 0)");
            none = 1;
          }
          else {
            $(this).css("border","1px inset rgb(128, 128, 128)");
          }
        });
        if (none) return false;
        let object = {
          account : $("#t1").val(),
          name : $("#t2").val(),
          password : $("#t3").val(),
          do : $("#s").val(),
        };
        $.post({
          async:false,
          url :"allcall.php?call=2",
          data : {object:object},
          success:function(e){
            $(".tr").remove();
            $.post({
              async:false,
              url : "allcall.php?call=1",
              success:function(e){
                creatnew();
                let list = e.split("$(*/)");
                let arr = [];
                list.pop();
                for (let i = 0 ; i < list.length; i++){
                  arr = JSON.parse(list[i]);
                  $("#tbody").append(`
                    <tr class="tr">
                      <td><input type="text" id="t0${arr[0]}" value="${arr[0]}"></td>
                      <td><input type="text" id="t1${arr[0]}" value="${arr[1]}"></td>
                      <td><input type="text" id="t2${arr[0]}" value="${arr[2]}"></td>
                      <td><input type="text" id="t3${arr[0]}" value="${arr[3]}"></td>
                      <td>
                        <select id="s${arr[0]}">
                          <option value="1">一般使用者</option>
                          <option value="2">一般管理者</option>
                          <option value="3">超級管理者</option>
                        <select>
                      </td>
                      <td>修改</td>
                      <td>刪除</td>
                    </tr>
                  `);
                  $("#s"+arr[0]).val(arr[4]);
                };
              },
            });
          }
        });
      })
      $(".fix").click(function(){
        let id = $(this).attr("id").substr(3);
        let object = {
          account : $("#t1"+id).val(),
          name : $("#t2"+id).val(),
          password : $("#t3"+id).val(),
          do : $("#s"+id).val(),
          id : id,
        };
        $.post({
          async : false,
          url : "allcall.php?call=3",
          data : {object : object},
        });
      });
      $(".dele").click(function(){
        let id = $(this).attr("id").substr(4);
        $.post({
          async : false,
          url : "allcall.php?call=4",
          data : {id : id},
        });
      });
    });
  </script>
  <script src="main.js"></script>
  </html>